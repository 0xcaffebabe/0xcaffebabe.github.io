---
layout: post
title:  "java如何扫描本项目下的所有类"
date:   2019-01-29T07:56:51
category: JAVA
tags: [JAVA]
---

java如何扫描本项目下的所有类

<p>最近在写一个依赖注入的小demo，碰到这么样的一个问题：</p><p>要把本项目下所有被@Component修饰的所有类注入到容器当中。</p><p>思路很简单，通过文件枚举的方式扫描出本项目的所有类文件，再对文件名进行一些小处理，就能得到本项目的所有类。</p><pre><code>public static void scanAllClasses() {<br>        String url = getClassPath();<br>        List&lt;String&gt; classes = getClassesList(url);<br>        // 遍历classes，如果发现@Component就注入到容器中<br>        scanComponent2Container(classes);<br><br>    }</code></pre><p>其中，getClassPath这个方法的实现如下：</p><pre><code>private static String getClassPath() {<br>        String url = URLDecoder.decode(Context.class.getResource("/").getPath(), Charset.defaultCharset());<br>        if (url.startsWith("/")) {<br>            url = url.replaceFirst("/", "");<br>        }<br>        url = url.replaceAll("/", "\\\\");<br>        return url;<br>    }</code></pre><p>就是通过类来取出这个类所在文件的绝对路径，并进行一些文本处理。</p><p>而getClassesList则是根据传入的类路径，通过递归进行文件枚举：</p><pre><code>private static List&lt;String&gt; getClassesList(String url) {<br>        File file = new File(url);<br>        List&lt;String&gt; classes = getAllClass(file);<br>        for (int i = 0; i &lt; classes.size(); i++) {<br>            classes.set(i, classes.get(i).replace(url, "").replace(".class", "").replace("\\", "."));<br>        }<br>        return classes;<br>    }</code></pre><p>递归函数：</p><pre><code>private static List&lt;String&gt; getAllClass(File file) {<br>        List&lt;String&gt; ret = new ArrayList&lt;&gt;();<br>        if (file.isDirectory()) {<br>            File[] list = file.listFiles();<br>            for (var i : list) {<br>                var j = getAllClass(i);<br>                ret.addAll(j);<br>            }<br>        } else {<br><br>            ret.add(file.getAbsolutePath());<br>        }<br>        return ret;<br> }</code></pre><p>基本原理就是判断file是否为目录，如果是，继续递归，否则如果文件是class文件，加入到list，返回。</p><p>那这样，就能得到本项目下的所有类。</p><p>值得注意的是，这种方式不适用jar执行包，因为如果java直接执行jar包的话，第一步得到的类路径就是jar包的地址。</p><p>所以如果最终运行的是jar包的话，必须通过jar输入流进行读取。</p><style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-536858881 -1073711013 9 0 511 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:等线;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:DengXian;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:-1610612033 953122042 22 0 262159 0;}
@font-face
	{font-family:"\@等线";
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:-1610612033 953122042 22 0 262159 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	mso-pagination:none;
	font-size:10.5pt;
	mso-bidi-font-size:11.0pt;
	font-family:等线;
	mso-ascii-font-family:等线;
	mso-ascii-theme-font:minor-latin;
	mso-fareast-font-family:等线;
	mso-fareast-theme-font:minor-fareast;
	mso-hansi-font-family:等线;
	mso-hansi-theme-font:minor-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;
	mso-font-kerning:1.0pt;}
.MsoChpDefault
	{mso-style-type:export-only;
	mso-default-props:yes;
	font-family:等线;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;}
 /* Page Definitions */
 @page
	{mso-page-border-surround-header:no;
	mso-page-border-surround-footer:no;}
@page WordSection1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:36.0pt;
	mso-footer-margin:36.0pt;
	mso-paper-source:0;}
div.WordSection1
	{page:WordSection1;}
-->
</style>